<!DOCTYPE html>
<html>

<head>
    <title>Admin - Dashboard [Aimelive]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <meta name="description" content="Aimelive | Freelance Developer | Official Biography website">
    <meta name="keywords" content="Aimelive, Biography, Awesome websites">
    <meta name="author" content="Aime Ndayambaje">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Rectangle 21.png" type="image/x-icon">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="./js/script.js"></script>

</head>

<body>


    <div class="header">
        <span class="humberg" onclick="openSideNav()"> <i class="fa fa-bars" aria-hidden="true"></i></span>
        <label id="logo_text">AimeLive</label>
        <div id="styledCard">
            <img src="Rectangle 21.png" onclick="showHidden()" id="styledImage" class="styledImage" />
            <div id="dropDownList" class="dropDown">
                <a href="#"><i class="fa fa-user"></i> &nbsp; Profile</a>
                <a href="#"><i class="fa fa-gear"> </i> &nbsp; Account Settings</a>
                <a href="#"><i class="fa fa-bar-chart"> </i> &nbsp; Analytics</a>
                <a class="logout" onclick="logout()"><i class="fa fa-power-off"></i> &nbsp; Log Out</a>
            </div>

        </div>
        <script src="./js/dropdown.js"></script>

    </div>
    <nav class="sidebar" id="sidebar">
        <a href="dashboard.html" style="background-color: white;"><i class="fa fa-home"></i> Dashboard </a>
        <a href="faq.html"><i class="fa fa-envelope"></i> Messages</a>
        <a href="news_article.html"><i class="fa fa-newspaper-o"></i> Blogs</a>
        <a href="addPost.html"><i class="fa fa-plus"></i> Add Blog</a>
        <a href="#"><i class="fa fa-bar-chart"></i> Analytics</a>
        <a href="#"> <i class="fa fa-gear"></i> User Account</a>
    </nav>
    <div class="dashboard">
        <div class="animationP">
            <h1 class="animateHeading">WELCOME TO ADMIN DASHBOARD </h1>
            <p class="animateText">Youâ€™re successfully logged in because you are allowed to manage everything on this website. </p>
        </div>
        <div id="overviewCard">
            <div id="dashCard">
                <i class="fa fa-newspaper-o"></i>
                <h2>90</h2>
                <span>Posts </span>
            </div>
            <div id="dashCard" style="color:#2EB67D;border-color:#2EB67D">
                <i class="fa fa-comments-o"></i>
                <h2>15</h2>
                <span>Comments</span>
            </div>
            <div id="dashCard" style="color:#3299F9;border-color:#3299F9">
                <i class="fa fa-envelope"></i>
                <h2>2</h2>
                <span class="totalMessages">New messages</span>
            </div>
            <div id="dashCard" style="color:#EA6767;border-color:#EA6767">
                <i class="fa fa-edit"></i>
                <h2>7</h2>
                <span>Drafts </span>
            </div>
        </div>
        <p>Recent Posts: </p>
        <div class="container">
            <div class="card">
                <img src="images/259876262_273615128057795_12441334990616548_n.jpg" />
                <span>2022: Aimelive nominated as the best developer in the world (PROJECTS) </span>
            </div>
            <div class="card">
                <img src="images/198807056_1350758038653763_5653275032777728992_n.jpg" />
                <span>2022: Aimelive nominated as the best developer in the world</span>
            </div>
            <div class="card">
                <img src="images/259876262_273615128057795_12441334990616548_n.jpg" />
                <span>2022: Aimelive nominated as the best developer in the world</span>
            </div>
            <div class="card">
                <img src="images/259876262_273615128057795_12441334990616548_n.jpg" />
                <span>2022: Aimelive nominated as the best developer in the world</span>
            </div>
        </div>

        <div id="myModal" class="showModal">
            <div class="modalContent">
                <span class="close" onclick="closeModal()">&times;</span>
                <img src="Rectangle 21.png" />
                <h2> Delete Message </h2>
                <p>Are you sure do you want to delete this message? <br> ðŸ‘‡ </p>
                <div class="messageBox">
                    <span class="com-o"> <i class="fa fa-comments-o"></i> </span> <span class="com-o" style="float: right;"> <i class="fa fa-comments-o"></i> </span>
                    <p class="divMessage"> Hey Aime, I love you so much!!! Hey Aime, I love you so much!!! Hey Aime, I love you so much!!! Hey Aime, I love you so much!!! Hey Aime, I love you so much!!!</p>
                    <span class="com-o"> <i class="fa fa-comments-o"></i> </span> <span class="com-o" style="float: right;"> <i class="fa fa-comments-o"></i> </span>
                </div>
                <p> <span class="divName"> NIYONSHUTI Frederick </span> ( <a href="#"><span class="divEmail">niyonshutipatricie@gmail.com </span></a>) </p>
                <div class="clearfix">
                    <button type="button" class="replybtn" style="background-color: #3299F9;">Reply</button>
                    <button type="button" class="cancelbtn" onclick="closeModal()">Cancel</button>
                    <button type="button" class="deletebtn">Delete</button>
                </div>
            </div>


        </div>



        <p>Recent Queries (5) </p>
        <div id="getM"></div>

        <a href="faq.html" class="href">
            <p style="color: #3299F9;text-align: center;text-decoration: underline;"> Load more...</p>
        </a>

    </div>
    <script>
        let status;
        let token = localStorage.getItem('token')

        window.onload = async(e) => {
            try {
                const resp = await fetch('https://my-brand-aimelive.herokuapp.com/api/v1/messages', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Authorization': token,
                    }
                })

                const data = await resp.json()
                    //console.log(resp)
                if (resp.status == 200) {
                    document.querySelector(".totalMessages").innerHTML = data.Data.messages.length;

                    for (let i = 0; i < 5; i++) {
                        const dataMessage = data.Data.messages[i];
                        //console.log(dataMessage.email)
                        const msgID = dataMessage._id;
                        const name = dataMessage.name;
                        const email = dataMessage.email;
                        const message = dataMessage.message;
                        const date = dataMessage.creationDate;
                        getMessage(name, email, message, msgID, date)

                    }
                    //console.log(data.Data.messages[10].email)
                }
                if (resp.status == 500 || resp.status == 400 || resp.status == 401 || resp.status == 404) {
                    console.log(data.Message)
                    swal({
                        title: `Status: ${data.Status} `,
                        text: data.Message,
                        icon: 'error'
                    }).then((u) => {
                        if (u) {
                            history.back()
                        }
                    })
                }


                function getMessage(name, email, message, msgID, date) {
                    const getM = document.getElementById("getM");
                    const faqs = document.createElement("div");
                    faqs.classList.add("faqs");
                    const container = `<img src="images/avatar.png" height="50px" width="50px" style="float: left;position: relative;top:10px">
    <p style="color: #3299F9;"><b><u>${name}</u></b> (${email})</p>
    <p>${message}</p>
    <button id="ans"><i class="fa fa-reply"></i> Answer</button>
    <button id="ign" class="${msgID}" onclick="showModal('${msgID}','${message}','${name}','${email}')"><i class="fa fa-trash"></i> Ignore</button>`
                    faqs.innerHTML = container;
                    getM.appendChild(faqs);
                }

            } catch (error) {
                console.log("AN ERROR OCCURED HERE!!" + error)
            }

        }
    </script>
    <script src="./js/deleteMessage.js"></script>
    <script src="js/logout.js"></script>
</body>

</html>