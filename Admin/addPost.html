<!DOCTYPE html>
<html>

<head>
    <title>Add Post - Aimelive </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <meta name="description" content="Aimelive | Freelance Developer | Official Biography website">
    <meta name="keywords" content="Aimelive, Biography, Awesome websites">
    <meta name="author" content="Aime Ndayambaje">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="Rectangle 21.png" type="image/x-icon">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="./js/script.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>




    <!--Summernote Editor-->

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

</head>

<body>

    <div class="header">

        <label id="logo_text">AimeLive</label>
        <div id="styledCard">
            <img src="Rectangle 21.png" onclick="showHidden()" id="styledImage" class="styledImage" />
            <div id="dropDownList" class="dropDown">
                <a href="#"><i class="fa fa-user"></i> &nbsp; Profile</a>
                <a href="#"><i class="fa fa-gear"> </i> &nbsp; Account Settings</a>
                <a href="#"><i class="fa fa-bar-chart"> </i> &nbsp; Analytics</a>
                <a href="#"><i class="fa fa-power-off"></i> &nbsp; Log Out</a>
            </div>

        </div>
        <script src="./js/dropdown.js"></script>
    </div>
    <nav class="sidebar">
        <a href="dashboard.html"><i class="fa fa-home"></i> Home</a>
        <a href="faq.html"><i class="fa fa-envelope"></i> Messages</a>
        <a href="#" style="background-color: white;"><i class="fa fa-newspaper-o"></i> Articles</a>
        <a href="comments.html"><i class="fa fa-comments-o"></i> Comments</a>
        <a href="#"><i class="fa fa-bar-chart"></i> Analytics</a>
        <a href="#"> <i class="fa fa-gear"></i> Account Settings</a>
    </nav>

    <div class="dashboard">
        <a href="news_article.html" class="back"><i class="fa fa-arrow-circle-o-left"></i> Back</a>



        <div class="addPost">
            <center>
                <img src="../images/images.png" width="50px" style="border-radius: 50%;" />
                <h1>Add Post <span style="color: #ECB22E;">@Aimelive</span> here </h1>
            </center>
            <form method="post" class="add-post-to-database" id="addPostFirebase" novalidate>
                <div class="row">
                    <div class="labelClass">
                        <label for="title">Enter a title: </label>
                    </div>
                    <div class="inputClass">
                        <input type="text" name="title" placeholder="Blog title.." required>
                    </div>
                </div>
                <div class="row">
                    <div class="labelClass">
                        <label for="category">Choose category: </label>
                    </div>
                    <div class="inputClass">
                        <select id="category" name="category" required>
                            <option value="">Select a category</option>
                            <option value="Motivation">Motivation</option>
                            <option value="Careers">Careers</option>
                            <option value="Projects">Projects</option>
                            <option value="Personal blog">Personal blog</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="labelClass">
                        <label for="Preview">Write a preview: </label>
                    </div>
                    <div class="inputClass">
                        <textarea name="preview" placeholder="Write a blog preview" style="resize: none;height: 200px;" required></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="labelClass">
                        <label for="blog">Write a blog: </label>
                    </div>

                    <div class="inputClass">
                        <textarea name="blog" id="summernote" placeholder="Write a blog..." required></textarea>

                    </div>
                </div>
                <div class="row" id="imagePreview">
                    <div class="labelClass">
                        <label for="image">Image Preview: </label>
                    </div>
                    <div class="inputClass" id="outputPreview">
                        <img src="" id="outputImage" height="200px" />
                    </div>
                </div>
                <div class="row">
                    <div class="labelClass">
                        <label for="image">Featured Photo: </label>
                    </div>
                    <div class="inputClass">
                        <input type="file" name="image" onchange="previewFile()" style="resize: none;" id="inputFile" accept="image/*">
                    </div>
                </div>
                <br>
                <div class="row">
                    <!-- <input type="reset" value="Clear">
                    <input type="button" value="Save"> -->
                    <input type="submit" value="Post">
                </div>
            </form>
            <script>
                const form = document.querySelector('.add-post-to-database');


                form.addEventListener('submit', async(e) => {
                    e.preventDefault()
                    const title = form.title.value
                    const category = form.category.value
                    const preview = form.preview.value
                    const body = form.blog.value
                    const imgURL = form.image.files[0]

                    try {

                        const formData = new FormData();

                        formData.append("title", title)
                        formData.append("category", category)
                        formData.append("preview", preview)
                        formData.append("body", body)
                        formData.append("imgURL", imgURL)

                        //console.log("AKIRA ISHIMWE " + formData + "AND THE TITLE " + title)

                        const resp = await fetch('https://my-brand-aimelive.herokuapp.com/api/v1/addBlog', {
                            method: 'POST',
                            headers: {
                                'Authorization': token
                            },
                            body: formData
                        })

                        const data = await resp.json()
                            //console.log(resp)
                        if (resp.status == 201) {
                            swal('Success', data.Message, 'success').then(() => {})

                        }

                        if (resp.status == 500) {
                            console.log(" MUKUNZI MWIZA NZIKO UNYUMVA" + data.Error)
                            swal(`Status: ` + data.Status, data.Message, 'error')

                        }

                        if (resp.status == 400) {
                            swal(data.Blog, data.Title, 'error')
                        }


                    } catch (error) {
                        console.log("AN ERROR OCCURED PLEASE" + error)
                    }

                })


                //finishing to add new post to a database


                $(document).ready(function() {
                    $('#summernote').summernote();
                });

                function previewFile() {
                    var pre = document.getElementById("imagePreview").style
                    var preview = document.querySelector('#outputImage');
                    var file = document.querySelector('#inputFile').files[0];
                    var reader = new FileReader();

                    reader.onloadend = function() {
                        preview.src = reader.result;
                    }


                    if (file) {
                        reader.readAsDataURL(file);
                        pre.display = "block"
                    } else {
                        swal("Oops", "Can't preview!!", "error")
                    }
                }
            </script>
        </div>

    </div>
</body>

</html>